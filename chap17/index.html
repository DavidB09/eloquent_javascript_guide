<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Eloquent JavaScript practice guide for chapter exercises and examples">
    <meta name="author" content="David Brunner">
    <meta name="keywords" content="JavaScript, Eloquent JavaScript, Chapter 17, Exercises">
    <meta name="description" content="Solutions and explanations for exercises in Chapter 17 of Eloquent JavaScript.">
    <title>Eloquent JavaScript - Chapter 17</title>

    <link href="../style.css" rel="stylesheet">
    <link href="../assets/css/prism.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=PT+Mono&display=swap" rel="stylesheet"> 
</head>

<body>

    <header>
        <h1>Chapter 17, "Drawing on Canvas"</h1>

        <div class="header-navigation-links">
            <a href="../chap16/index.html" alt="Chapter 16 Link" title="Chapter 16">Previous</a>
            <a href="../chap18/index.html" alt="Chapter 18 Link" title="Chapter 18">Next</a>
        </div>
    </header>

    <main>

        <article class="container-exercise-problems">

            <section class="exercise-panel">
                <div class="exercise-header"><h2>Shapes</h2></div>

                <div class="exercise-body">
                    <h3>Question</h3>

                    <p>Write a program that draws the following shapes on a canvas:</p>

                    <ol>
                        <li>A trapezoid (a rectangle that is wider on one side)</li>
                        <li>A red diamond (a rectangle rotated 45 degrees or ¼π radians)</li>
                        <li>A zigzagging line</li>
                        <li>A spiral made up of 100 straight line segments</li>
                        <li>A yellow star</li>
                    </ol>
                </div>

                <div class="exercise-body">
                    <h3>Personal Answer</h3>

                    <pre id="code1" class="line-numbers linkable-line-numbers language-javascript" tabindex="0" data-line="0"><code class="language-javascript">let cx = document.querySelector("canvas").getContext("2d");

function drawTrapezoid(x, y, width, height) {
    cx.moveTo(x + Math.floor(width * 0.25), y);
    cx.lineTo(x + Math.floor(width * 0.75), y); 
    cx.lineTo(x + width, y + height); 
    cx.lineTo(x, y + height);
    cx.lineTo(x + Math.floor(width * 0.25), y);
}

function drawDiamond(x, y, width, height) {
    cx.fillStyle = "red"; 
    cx.save();
    cx.translate(x, y);
    cx.rotate(45 * (Math.PI / 180));
    cx.fillRect(0, 0, width, height);
    cx.restore();
}

function drawZigZag(x, y, width, height, num) {
    cx.moveTo(x, y);
    for (let i = 0; i <= num; i++) {
        if (i % 2 == 0) cx.lineTo(x, y + height * i);
        else cx.lineTo(x + width, y + height * i); 
    }
}

function drawSpiral(x, y, width, height) {
    cx.moveTo(x, y);
    let angle = 0; 
    let gradient = 1; 
    for (let i = 1; i < 100; i++) {
        let newX = (Math.cos(angle) * (width * gradient) + x); 
        let newY = (Math.sin(angle) * (height * gradient) + y); 

        cx.lineTo(newX, newY);
        angle += 0.3; 
        gradient += 0.1; 
    }
    cx.stroke(); 
}

function drawStar(x, y, width) {
    cx.beginPath();
    let currentPosition = 0; 
    let [currentX, currentY] = [x + width, y]; 
    let [nextX, nextY] = [0, 0]; 
    for (let i = 0; i < 9; i++, currentPosition += 45) {
        nextX = Math.cos(currentPosition * (Math.PI / 180)) * width + x; 
        nextY = Math.sin(currentPosition * (Math.PI / 180)) * width + y; 

        i == 0 ? cx.moveTo(nextX, nextY) : cx.quadraticCurveTo(x, y, nextX, nextY); 
        [currentX, currentY] = [nextX, nextY]; 
    }
    cx.fillStyle = "gold";
    cx.fill();
}

cx.beginPath();
drawTrapezoid(10, 20, 50, 30);
drawDiamond(110, 20, 25, 25);
drawZigZag(150, 20, 40, 10, 5);
drawSpiral(275, 70, 5, 5);
drawStar(400, 50, 40);</code></pre>
                </div>

                <div class="exercise-body exercise-desc">
                    <p><code class="desc desc-code1" data-line="1">Line 1</code> creates the <code>cx</code> variable that initiates the context and allows drawing on the <code>canvas</code> DOM element.</p>

                    <p><code class="desc desc-code1" data-line="3">Line 3</code> defines the <code>drawTrapezoid</code> function that receives the position and size values of the trapezoid.</p>

                    <p><code class="desc desc-code1" data-line="4">Line 4</code> begins drawing the trapezoid by moving the drawing position to the upper-left corner, denoted by addition of <code>x</code> and 1/4 of the <code>width</code> value along with the regular <code>y</code> value.</p>

                    <p><code class="desc desc-code1" data-line="5">Line 5</code> draws a line segment to the upper-right corner, denoted by the addition of <code>x</code> and 3/4 of the <code>width</code> value along with the regular <code>y</code> value.</p>

                    <p><code class="desc desc-code1" data-line="6">Line 6</code> draws a line segment to the lower-right corner, denoted by the addition of <code>x</code> and the total <code>width</code> value along with the addition of <code>y</code> and the total <code>height</code> value.</p>

                    <p><code class="desc desc-code1" data-line="7">Line 7</code> draws a line segment to the lower-left corner, denoted by the regular <code>x</code> value along with the addition of <code>y</code> and the total <code>height</code> value.</p>

                    <p><code class="desc desc-code1" data-line="8">Line 8</code> draws a line segment back to the upper-left corner.</p>

                    <p><code class="desc desc-code1" data-line="11">Line 11</code> defines the <code>drawDiamond</code> function that receives the position and size values of the diamond.</p>

                    <p><code class="desc desc-code1" data-line="12">Line 12</code> sets the <code>fillStyle</code> value of <code>cx</code> to the string <code>"red"</code>.</p>

                    <p><code class="desc desc-code1" data-line="13">Line 13</code> saves the original alignment of <code>cx</code> by calling the <code>save</code> method.</p>

                    <p><code class="desc desc-code1" data-line="14">Line 14</code> moves or translates the drawing point to the <code>x</code> and <code>y</code> values.</p>

                    <p><code class="desc desc-code1" data-line="15">Line 15</code> rotates the canvas drawing element by 45 degrees converted to radians.</p>

                    <p><code class="desc desc-code1" data-line="16">Line 16</code> draws a rectangle by calling the <code>fillRect</code> method with <code>0</code> for the x and y point along with the <code>width</code> and <code>height</code> values.</p>

                    <p><code class="desc desc-code1" data-line="17">Line 17</code> restores <code>cx</code> to its original alignment <code>cx</code> by calling the <code>restore</code> method.</p>

                    <p><code class="desc desc-code1" data-line="20">Line 20</code> defines the <code>drawZigZag</code> function that receives the position, size, and total count of zig-zags.</p>

                    <p><code class="desc desc-code1" data-line="21">Line 21</code> moves the drawing point to the <code>x</code> and <code>y</code> values.</p>

                    <p><code class="desc desc-code1" data-line="22">Line 22</code> iterates using a <code>for</code> loop until the total number of zigzag lines has been drawn.</p>

                    <p><code class="desc desc-code1" data-line="23">Line 23</code> checks whether <code>i</code> is even and draws a line segment to the starting <code>x</code> value along with the addition of <code>y</code> and <code>height</code> multiplied by the current number of lines.</p>

                    <p>Else, <code class="desc desc-code1" data-line="24">Line 24</code> draws a line segment to the ending <code>x</code> value along with the addition of <code>y</code> and <code>height</code> multiplied by the current number of lines.</p>

                    <p><code class="desc desc-code1" data-line="28">Line 28</code> defines the <code>drawSpiral</code> function that receives the position and size values of the spiral.</p>

                    <p><code class="desc desc-code1" data-line="29">Line 29</code> moves the drawing point to the <code>x</code> and <code>y</code> values.</p>

                    <p><code class="desc desc-code1" data-line="30">Line 30</code> initializes the new variable <code>angle</code> to zero.</p>

                    <p><code class="desc desc-code1" data-line="31">Line 31</code> initializes the new variable <code>gradient</code> to one.</p>

                    <p><code class="desc desc-code1" data-line="32">Line 32</code> iterates a hundred times using a <code>for</code> loop.</p>

                    <p><code class="desc desc-code1" data-line="33">Line 33</code> creates the variable <code>newX</code> and sets it to the result of multiplying the cosine value calculated by the current <code>angle</code> and the product of <code>width</code> and <code>gradient</code>, all increased by the addition of <code>x</code>.</p>

                    <p><code class="desc desc-code1" data-line="34">Line 34</code> creates the variable <code>newY</code> and sets it to the result of multiplying the sin value calculated by the current <code>angle</code> and the product of <code>height</code> and <code>gradient</code>, all increased by the addition of <code>y</code>.</p>

                    <p><code class="desc desc-code1" data-line="36">Line 36</code> draws a line segment to the newly calculated <code>newX</code> and <code>newY</code> values.</p>

                    <p><code class="desc desc-code1" data-line="37">Line 37</code> increases <code>angle</code> by <code>0.3</code> to continue moving in a circle.</p>

                    <p><code class="desc desc-code1" data-line="38">Line 38</code> increases <code>gradient</code> by <code>0.1</code> to continue gradually increasing the size of the circle.</p>

                    <p><code class="desc desc-code1" data-line="40">Line 40</code> calls the <code>stroke</code> method on <code>cx</code> to outline all of the previously drawn line segments.</p>

                    <p><code class="desc desc-code1" data-line="43">Line 43</code> defines the <code>drawStar</code> function that receives the position and width values of the star.</p>

                    <p><code class="desc desc-code1" data-line="44">Line 44</code> begins a new drawing path of the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code1" data-line="45">Line 45</code> initializes the new variable <code>currentPosition</code> to zero.</p>

                    <p><code class="desc desc-code1" data-line="46">Line 46</code> initializes the new variables <code>currentX</code> and <code>currentY</code> to <code>x</code> increased by <code>width</code> and <code>y</code> respectively.</p>

                    <p><code class="desc desc-code1" data-line="47">Line 47</code> initializes both of the new variables <code>nextX</code> and <code>nextY</code> to zero.</p>

                    <p><code class="desc desc-code1" data-line="48">Line 48</code> iterates nine times using a <code>for</code> loop, increasing <code>currentPosition</code> by <code>45</code> each time.</p>

                    <p><code class="desc desc-code1" data-line="49">Line 49</code> sets <code>nextX</code> to the cosine value of the <code>currentPosition</code> angle converted to radians, multiplied by <code>width</code>, and increased by <code>x</code>.</p>

                    <p><code class="desc desc-code1" data-line="50">Line 50</code> sets <code>nextY</code> to the sin value of the <code>currentPosition</code> angle converted to radians, multiplied by <code>width</code>, and increased by <code>y</code>.</p>

                    <p><code class="desc desc-code1" data-line="52">Line 52</code> checks if <code>i</code> is equal to <code>0</code>, moving the drawing point to the <code>nextX</code> and <code>nextY</code> values if true, or drawing a quadratic curve from the <code>x</code> and <code>y</code> values to the <code>nextX</code> and <code>nextY</code> values.</p>

                    <p><code class="desc desc-code1" data-line="53">Line 53</code> updates <code>currentX</code> and <code>currentY</code> values to the <code>nextX</code> and <code>nextY</code> values.</p>

                    <p><code class="desc desc-code1" data-line="55">Line 55</code> sets the <code>fillStyle</code> property of <code>cx</code> to <code>"gold"</code>.</p>

                    <p><code class="desc desc-code1" data-line="56">Line 56</code> calls the <code>fill</code> method of <code>cx</code> to color the previously drawn star.</p>

                    <p><code class="desc desc-code1" data-line="59">Line 59</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code1" data-line="60">Line 60</code> calls <code>drawTrapezoid</code> with a set of values for the position and size of the shape.</p>

                    <p><code class="desc desc-code1" data-line="61">Line 61</code> calls <code>drawDiamond</code> with a set of values for the position and size of the shape.</p>

                    <p><code class="desc desc-code1" data-line="62">Line 62</code> calls <code>drawZigZag</code> with a set of values for the position, size, and total number of lines.</p>

                    <p><code class="desc desc-code1" data-line="63">Line 63</code> calls <code>drawSpiral</code> with a set of values for the position and size of the shape.</p>

                    <p><code class="desc desc-code1" data-line="64">Line 64</code> calls <code>drawStar</code> with a set of values for the position and width of the shape.</p>
                </div>

                <div class="exercise-body">
                    <h3>Author's Answer</h3>

                    <pre id="code2" class="line-numbers linkable-line-numbers language-javascript" tabindex="0" data-line="0"><code class="language-javascript">let cx = document.querySelector("canvas").getContext("2d");

function trapezoid(x, y) {
    cx.beginPath();
    cx.moveTo(x, y);
    cx.lineTo(x + 50, y);
    cx.lineTo(x + 70, y + 50);
    cx.lineTo(x - 20, y + 50);
    cx.closePath();
    cx.stroke();
}
trapezoid(30, 30);

function diamond(x, y) {
    cx.translate(x + 30, y + 30);
    cx.rotate(Math.PI / 4);
    cx.fillStyle = "red";
    cx.fillRect(-30, -30, 60, 60);
    cx.resetTransform();
}
diamond(140, 30);

function zigzag(x, y) {
    cx.beginPath();
    cx.moveTo(x, y);
    for (let i = 0; i < 8; i++) {
        cx.lineTo(x + 80, y + i * 8 + 4);
        cx.lineTo(x, y + i * 8 + 8);
    }
    cx.stroke();
}
zigzag(240, 20);

function spiral(x, y) {
    let radius = 50, xCenter = x + radius, yCenter = y + radius;
    cx.beginPath();
    cx.moveTo(xCenter, yCenter);
    for (let i = 0; i < 300; i++) {
        let angle = i * Math.PI / 30;
        let dist = radius * i / 300;
        cx.lineTo(xCenter + Math.cos(angle) * dist, yCenter + Math.sin(angle) * dist);
    }
    cx.stroke();
}
spiral(340, 20);

function star(x, y) {
    let radius = 50, xCenter = x + radius, yCenter = y + radius;
    cx.beginPath();
    cx.moveTo(xCenter + radius, yCenter);
    for (let i = 1; i <= 8; i++) {
        let angle = i * Math.PI / 4;
        cx.quadraticCurveTo(xCenter, yCenter, xCenter + Math.cos(angle) * radius, yCenter + Math.sin(angle) * radius);
    }
    cx.fillStyle = "gold";
    cx.fill();
}
star(440, 20);      </code></pre>
                </div>

                <div class="exercise-body exercise-desc">
                    <p><code class="desc desc-code2" data-line="1">Line 1</code> creates the <code>cx</code> variable that initiates the context and allows drawing on the <code>canvas</code> DOM element.</p>

                    <p><code class="desc desc-code2" data-line="3">Line 3</code> defines the <code>trapezoid</code> function that receives the x and y coordinates of the trapezoid.</p>

                    <p><code class="desc desc-code2" data-line="4">Line 4</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code2" data-line="5">Line 5</code> begins drawing the trapezoid by moving the drawing position to the upper-left corner, denoted by the <code>x</code> and <code>y</code> values.</p>

                    <p><code class="desc desc-code2" data-line="6">Line 6</code> draws a line segment to the upper-right corner, denoted by the addition of <code>x</code> and 50 along with the regular <code>y</code> value.</p>

                    <p><code class="desc desc-code2" data-line="7">Line 7</code> draws a line segment to the lower-right corner, denoted by the addition of <code>x</code> and 70 along with the addition of <code>y</code> and 50.</p>

                    <p><code class="desc desc-code2" data-line="8">Line 8</code> draws a line segment to the lower-left corner, denoted by the subtraction of <code>x</code> and 20 along with the addition of <code>y</code> and 50.</p>

                    <p><code class="desc desc-code2" data-line="9">Line 9</code> closes the drawing path and draws a line segment back to the starting point by calling the <code>closePath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code2" data-line="10">Line 10</code> calls the <code>stroke</code> method on <code>cx</code> to outline all of the previously drawn line segments.</p>

                    <p><code class="desc desc-code2" data-line="12">Line 12</code> calls <code>trapezoid</code> with a set of values for the x and y coordinates of the shape.</p>

                    <p><code class="desc desc-code2" data-line="14">Line 14</code> defines the <code>diamond</code> function that receives the x and y coordinates of the diamond.</p>

                    <p><code class="desc desc-code2" data-line="15">Line 15</code> moves the drawing point by calling the <code>translate</code> method with the <code>x</code> and <code>y</code> values increased by 30.</p>

                    <p><code class="desc desc-code2" data-line="16">Line 16</code> rotates the canvas drawing element by <code>Math.PI</code> divided by four, or 45 degrees.</p>

                    <p><code class="desc desc-code2" data-line="17">Line 17</code> sets the <code>fillStyle</code> value of <code>cx</code> to the string <code>"red"</code>.</p>

                    <p><code class="desc desc-code2" data-line="18">Line 18</code> draws a rectangle by calling the <code>fillRect</code> method with the x and y coordinates for the upper-left corner shifted back 30 pixels and the width and height being 60.</p>

                    <p><code class="desc desc-code2" data-line="19">Line 19</code> calls the <code>resetTransform</code> method of <code>cx</code> to reverse the previous translations and rotations and reset the canvas element to its original alignment.</p>

                    <p><code class="desc desc-code2" data-line="21">Line 21</code> calls <code>diamond</code> with a set of values for the x and y coordinates of the shape.</p>

                    <p><code class="desc desc-code2" data-line="23">Line 23</code> defines the <code>zigzag</code> function that receives the x and y coordinates of the trapezoid.</p>

                    <p><code class="desc desc-code2" data-line="24">Line 24</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code2" data-line="25">Line 25</code> moves the drawing point by calling the <code>translate</code> method with the <code>x</code> and <code>y</code> values.</p>

                    <p><code class="desc desc-code2" data-line="26">Line 26</code> uses a <code>for</code> loop to iterate 8 times.</p>

                    <p><code class="desc desc-code2" data-line="27">Line 27</code> draws a line segment to the zig point, denoted by <code>x</code> increased by 80 and <code>i</code> multiplied by 8 before being added, along with <code>4</code>, to <code>y</code>.</p>

                    <p><code class="desc desc-code2" data-line="28">Line 28</code> draws a line segment to the zag point, denoted by the <code>x</code> value and <code>i</code> multiplied by 8 before being added, along with <code>8</code>, to <code>y</code>.</p>

                    <p><code class="desc desc-code2" data-line="30">Line 30</code> calls the <code>stroke</code> method on <code>cx</code> to outline all of the previously drawn line segments.</p>

                    <p><code class="desc desc-code2" data-line="32">Line 32</code> calls <code>zigzag</code> with a set of values for the x and y coordinates of the shape.</p>

                    <p><code class="desc desc-code2" data-line="34">Line 34</code> defines the <code>spiral</code> function that receives the x and y coordinates of the spiral.</p>

                    <p><code class="desc desc-code2" data-line="35">Line 35</code> initializes <code>radius</code> to 50, <code>xCenter</code> to <code>x</code> plus <code>radius</code>, and <code>yCenter</code> to <code>y</code> plus <code>radius</code>.</p>

                    <p><code class="desc desc-code2" data-line="36">Line 36</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code2" data-line="37">Line 37</code> moves the drawing point to the center of the spiral by calling the <code>translate</code> method with the <code>xCenter</code> and <code>yCenter</code> values.</p>

                    <p><code class="desc desc-code2" data-line="38">Line 38</code> uses a <code>for</code> loop to iterate 300 times.</p>

                    <p><code class="desc desc-code2" data-line="39">Line 39</code> creates the <code>angle</code> value and sets it the result of multiplying <code>i</code> by <code>Math.PI</code> divided by 30.</p>

                    <p><code class="desc desc-code2" data-line="40">Line 40</code> creates the <code>dist</code> value and sets it to the result of multiplying <code>radius</code> by <code>i</code> divided by 300.</p>

                    <p><code class="desc desc-code2" data-line="41">Line 41</code> draws a line segment to the next point on the spiral, denoted by <code>xCenter</code> increased by the cosine value of <code>angle</code> multiplied by <code>dist</code>, and <code>yCenter</code> increased by the sine value of <code>angle</code> multiplied by <code>dist</code>.</p>

                    <p><code class="desc desc-code2" data-line="43">Line 43</code> calls the <code>stroke</code> method on <code>cx</code> to outline all of the previously drawn line segments.</p>

                    <p><code class="desc desc-code2" data-line="45">Line 45</code> calls <code>spiral</code> with a set of values for the x and y coordinates of the shape.</p>

                    <p><code class="desc desc-code2" data-line="47">Line 47</code> defines the <code>star</code> function that receives the x and y coordinates of the star.</p>

                    <p><code class="desc desc-code2" data-line="48">Line 48</code> initializes <code>radius</code> to 50, <code>xCenter</code> to <code>x</code> plus <code>radius</code>, and <code>yCenter</code> to <code>y</code> plus <code>radius</code>.</p>

                    <p><code class="desc desc-code2" data-line="49">Line 49</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code2" data-line="50">Line 50</code> moves the drawing point by calling the <code>translate</code> method with the <code>xCenter</code> increased by <code>radius</code> and <code>yCenter</code> value.</p>

                    <p><code class="desc desc-code2" data-line="51">Line 51</code> uses a <code>for</code> loop to iterate 8 times.</p>

                    <p><code class="desc desc-code2" data-line="52">Line 52</code> creates the <code>angle</code> value and sets it the result of multiplying <code>i</code> by <code>Math.PI</code> divided by 4.</p>

                    <p><code class="desc desc-code2" data-line="53">Line 53</code> calls the <code>quadraticCurveTo</code> method to draw a curve from <code>xCenter</code> and <code>yCenter</code> to <code>xCenter</code> increased by the cosine value of <code>angle</code> multiplied by <code>radius</code> and <code>yCenter</code> increased by the sine value of <code>angle</code> multiplied by <code>radius</code>.</p>

                    <p><code class="desc desc-code2" data-line="55">Line 55</code> sets the <code>fillStyle</code> property of <code>cx</code> to <code>"gold"</code>.</p>

                    <p><code class="desc desc-code2" data-line="56">Line 56</code> calls the <code>fill</code> method of <code>cx</code> to color the previously drawn star.</p>

                    <p><code class="desc desc-code2" data-line="58">Line 58</code> calls <code>star</code> with a set of values for the x and y coordinates of the shape.</p>
                </div>

                <button class="exercise-body exercise-close">⇮</button>
            </section>

            <section class="exercise-panel">
                <div class="exercise-header"><h2>The Pie Chart</h2></div>

                <div class="exercise-body">
                    <h3>Question</h3>

                    <p>Earlier in the chapter, we saw an example program that drew a pie chart. Modify this program so that the name of each category is shown next to the slice that represents it. Try to find a pleasing-looking way to automatically position this text that would work for other data sets as well. You may assume that categories are big enough to leave ample room for their labels.</p> 
                </div>

                <div class="exercise-body">
                    <h3>Personal Answer</h3>

                    <pre id="code3" class="line-numbers linkable-line-numbers language-javascript" tabindex="0" data-line="0"><code class="language-javascript">let cx = document.querySelector("canvas").getContext("2d");
let total = results.reduce((sum, {count}) => sum + count, 0);
let currentAngle = -0.5 * Math.PI;
let centerX = 300, centerY = 150;

for (let result of results) {
    let sliceAngle = (result.count / total) * 2 * Math.PI;
    let middleAngle = currentAngle + sliceAngle / 2; 

    cx.beginPath();

    let textX = Math.cos(middleAngle) * 120 + centerX; 
    let textY = Math.sin(middleAngle) * 120 + centerY; 
    cx.textAlign = middleAngle > 0.5 * Math.PI ? "end" : "start"; 
    cx.fillStyle = "black"; 
    cx.fillText(result.name, textX, textY); 

    cx.arc(centerX, centerY, 100, currentAngle, currentAngle + sliceAngle);
    currentAngle += sliceAngle;
    cx.lineTo(centerX, centerY);
    cx.fillStyle = result.color;
    cx.fill();
}                   </code></pre>
                </div>

                <div class="exercise-body exercise-desc">
                    <p><code class="desc desc-code3" data-line="1">Line 1</code> creates the <code>cx</code> variable that initiates the context and allows drawing on the <code>canvas</code> DOM element.</p>

                    <p><code class="desc desc-code3" data-line="2">Line 2</code> creates the <code>total</code> variable and assigns it to the result of adding each <code>count</code> value within the <code>results</code> array.</p>

                    <p><code class="desc desc-code3" data-line="3">Line 3</code> initializes <code>currentAngle</code> to the negative half value of <code>Math.PI</code> since the pie chart begins at the top of the circle.</p>

                    <p><code class="desc desc-code3" data-line="4">Line 4</code> initializes <code>centerX</code> to 300 and <code>centerY</code> to 150.</p>

                    <p><code class="desc desc-code3" data-line="6">Line 6</code> uses a <code>for</code> loop to iterate through each <code>result</code> object within the array <code>results</code>.</p>

                    <p><code class="desc desc-code3" data-line="7">Line 7</code> creates <code>sliceAngle</code> to represent how much of the circle the <code>result</code> object should have, and calculates it by dividing the <code>count</code> value by <code>total</code> and multiplying that by 2 and by <code>Math.PI</code>, or 360 degrees.</p>

                    <p><code class="desc desc-code3" data-line="8">Line 8</code> creates <code>middleAngle</code> to find the middle point of the portion that the current <code>result</code> object has, and calculates it by dividing <code>sliceAngle</code> by 2 and adding it to <code>currentAngle</code>.</p>

                    <p><code class="desc desc-code3" data-line="10">Line 10</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code3" data-line="12">Line 12</code> creates the <code>textX</code> variable and assigns it to the result of multiplying the cosine value of <code>middleAngle</code> by 120 before adding <code>centerX</code>.</p>

                    <p><code class="desc desc-code3" data-line="13">Line 13</code> creates the <code>textY</code> variable and assigns it to the result of multiplying the sine value of <code>middleAngle</code> by 120 before adding <code>centerY</code>.</p>

                    <p><code class="desc desc-code3" data-line="14">Line 14</code> checks whether <code>middleAngle</code> is greater than half of <code>Math.PI</code>, or 90 degrees, and sets the <code>textAlign</code> value of <code>cx</code> to <code>"end"</code> if true or <code>"start"</code> otherwise.</p>

                    <p><code class="desc desc-code3" data-line="15">Line 15</code> sets the <code>fillStyle</code> value of <code>cx</code> to <code>"black"</code>.</p>

                    <p><code class="desc desc-code3" data-line="16">Line 16</code> creates the label by calling the <code>fillText</code> method of <code>cx</code> with the <code>name</code> value of <code>result</code>, the <code>textX</code> value, and the <code>textY</code> value.</p>

                    <p><code class="desc desc-code3" data-line="18">Line 18</code> calls the <code>arc</code> method of <code>cx</code> create an arc with the center located at the <code>centerX</code> and <code>centerY</code> values, the radius being 100 pixels, the start angle at the <code>currentAngle</code>, and the end angle calculated by adding <code>currentAngle</code> and <code>sliceAngle</code>.</p>

                    <p><code class="desc desc-code3" data-line="19">Line 19</code> increases <code>currentAngle</code> by <code>sliceAngle</code> to continue drawing the next <code>result</code> object.</p>

                    <p><code class="desc desc-code3" data-line="20">Line 20</code> draws a line segment to the center of the circle.</p>

                    <p><code class="desc desc-code3" data-line="21">Line 21</code> sets the <code>fillStyle</code> value of <code>cx</code> to the <code>color</code> value of <code>result</code>.</p>

                    <p><code class="desc desc-code3" data-line="22">Line 22</code> calls the <code>fill</code> method of <code>cx</code> to draw the portion of the circle that represents <code>result</code>.</p>
                </div>

                <div class="exercise-body">
                    <h3>Author's Answer</h3>

                    <pre id="code4" class="line-numbers linkable-line-numbers language-javascript" tabindex="0" data-line="0"><code class="language-javascript">let cx = document.querySelector("canvas").getContext("2d");
let total = results.reduce(function(sum, choice) {
    return sum + choice.count;
}, 0);

let currentAngle = -0.5 * Math.PI;
let centerX = 300, centerY = 150;

results.forEach(function(result) {
    let sliceAngle = (result.count / total) * 2 * Math.PI;
    cx.beginPath();
    cx.arc(centerX, centerY, 100, currentAngle, currentAngle + sliceAngle);

    let middleAngle = currentAngle + 0.5 * sliceAngle;
    let textX = Math.cos(middleAngle) * 120 + centerX;
    let textY = Math.sin(middleAngle) * 120 + centerY;
    cx.textBaseLine = "middle";
    if (Math.cos(middleAngle) > 0) {
        cx.textAlign = "left";
    } else {
        cx.textAlign = "right";
    }
    cx.font = "15px sans-serif";
    cx.fillStyle = "black";
    cx.fillText(result.name, textX, textY);

    currentAngle += sliceAngle;
    cx.lineTo(centerX, centerY);
    cx.fillStyle = result.color;
    cx.fill();
});                 </code></pre>
                </div>

                <div class="exercise-body exercise-desc">
                    <p><code class="desc desc-code4" data-line="1-7">Line 1 - Line 7</code> is explained in my personal answer.</p>

                    <p><code class="desc desc-code4" data-line="9">Line 9</code> iterates through each <code>result</code> object within the <code>results</code> array using a <code>forEach</code> loop.</p>

                    <p><code class="desc desc-code4" data-line="10">Line 10</code> creates <code>sliceAngle</code> to represent how much of the circle the <code>result</code> object should have, and calculates it by dividing the <code>count</code> value by <code>total</code> and multiplying that by 2 and by <code>Math.PI</code>, or 360 degrees.</p>

                    <p><code class="desc desc-code4" data-line="11">Line 11</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code4" data-line="12">Line 12</code> calls the <code>arc</code> method of <code>cx</code> create an arc with the center located at the <code>centerX</code> and <code>centerY</code> values, the radius being 100 pixels, the start angle at the <code>currentAngle</code>, and the end angle calculated by adding <code>currentAngle</code> and <code>sliceAngle</code>.</p>

                    <p><code class="desc desc-code4" data-line="14">Line 14</code> creates <code>middleAngle</code> to find the middle point of the portion that the current <code>result</code> object has, and calculates it by multiplying <code>sliceAngle</code> by 0.5 and adding it to <code>currentAngle</code>.</p>

                    <p><code class="desc desc-code4" data-line="15">Line 15</code> creates the <code>textX</code> variable and assigns it to the result of multiplying the cosine value of <code>middleAngle</code> by 120 before adding <code>centerX</code>.</p>

                    <p><code class="desc desc-code4" data-line="16">Line 16</code> creates the <code>textY</code> variable and assigns it to the result of multiplying the sine value of <code>middleAngle</code> by 120 before adding <code>centerY</code>.</p>

                    <p><code class="desc desc-code4" data-line="17">Line 17</code> sets the <code>textBaseLine</code> value of <code>cx</code> to <code>"middle"</code>.</p>

                    <p><code class="desc desc-code4" data-line="18">Line 18</code> checks whether the cosine value of <code>middleAngle</code> is greater than zero.</p>

                    <p>If true, <code class="desc desc-code4" data-line="19">Line 19</code> sets the <code>textAlign</code> value of <code>cx</code> to <code>"left"</code>.</p>

                    <p>Else, <code class="desc desc-code4" data-line="21">Line 21</code> sets the <code>textAlign</code> value of <code>cx</code> to <code>"right"</code>.</p>

                    <p><code class="desc desc-code4" data-line="23">Line 23</code> sets the <code>font</code> value of <code>cx</code> to <code>"15px sans-serif"</code>.</p>

                    <p><code class="desc desc-code4" data-line="24">Line 24</code> sets the <code>fillStyle</code> value of <code>cx</code> to <code>"black"</code>.</p>

                    <p><code class="desc desc-code4" data-line="25">Line 25</code> creates the label by calling the <code>fillText</code> method of <code>cx</code> with the <code>name</code> value of <code>result</code>, the <code>textX</code> value, and the <code>textY</code> value.</p>

                    <p><code class="desc desc-code4" data-line="27">Line 27</code> increases <code>currentAngle</code> by <code>sliceAngle</code> to continue drawing the next <code>result</code> object.</p>

                    <p><code class="desc desc-code4" data-line="28">Line 28</code> draws a line segment to the center of the circle.</p>

                    <p><code class="desc desc-code4" data-line="29">Line 29</code> sets the <code>fillStyle</code> value of <code>cx</code> to the <code>color</code> value of <code>result</code>.</p>

                    <p><code class="desc desc-code4" data-line="30">Line 30</code> calls the <code>fill</code> method of <code>cx</code> to draw the portion of the circle that represents <code>result</code>.</p>
                </div>

                <button class="exercise-body exercise-close">⇮</button>
            </section>

            <section class="exercise-panel">
                <div class="exercise-header"><h2>A Bouncing Ball</h2></div>

                <div class="exercise-body">
                    <h3>Question</h3>

                    <p>Use the <code>requestAnimationFrame</code> technique that we saw in Chapter 14 and Chapter 16 to draw a box with a bouncing ball in it. The ball moves at a constant speed and bounces off the box’s sides when it hits them.</p> 
                </div>

                <div class="exercise-body">
                    <h3>Personal Answer</h3>

                    <pre id="code5" class="line-numbers linkable-line-numbers language-javascript" tabindex="0" data-line="0"><code class="language-javascript">let lineWidth = 5; 
let rectLeftX = 100, rectLeftY = 100, rectLength = 200; 
let circleX = 200, circleY = 110, circleRadius = 5; 
let speedX = 150, speedY = 175; 

function updateAnimation(step) {
    cx.beginPath(); 

    cx.clearRect(rectLeftX, rectLeftY, rectLength, rectLength); 
    cx.strokeStyle = "purple", cx.lineWidth = `${lineWidth}px`; 
    cx.strokeRect(rectLeftX, rectLeftY, rectLength, rectLength), 

    circleX += step * speedX, circleY += step * speedY; 

    cx.strokeStyle = "red", cx.fillStyle = "red"; 
    cx.arc(circleX, circleY, circleRadius, 0, 2 * Math.PI);
    cx.fill();

    if (circleX + circleRadius + lineWidth >= rectLeftX + rectLength 
      || circleX - circleRadius - lineWidth <= rectLeftX) {
        speedX *= -1;
    }

    if (circleY + circleRadius + lineWidth >= rectLeftY + rectLength
      || circleY - circleRadius - lineWidth <= rectLeftY) {
        speedY *= -1; 
    }
}                   </code></pre>
                </div>

                <div class="exercise-body exercise-desc">
                    <p><code class="desc desc-code5" data-line="1">Line 1</code> initializes <code>lineWidth</code> to 5.</p>

                    <p><code class="desc desc-code5" data-line="2">Line 2</code> initializes <code>rectLeftX</code> to 100, <code>rectLeftY</code> to 100, and <code>rectLength</code> to 200.</p>

                    <p><code class="desc desc-code5" data-line="3">Line 3</code> initializes <code>circleX</code> to 200 to begin at the middle, <code>circleY</code> to 110 to begin at the top, and <code>circleRadius</code> to 5.</p>

                    <p><code class="desc desc-code5" data-line="4">Line 4</code> initializes <code>speedX</code> to 150 and <code>speedY</code> to 175.</p>

                    <p><code class="desc desc-code5" data-line="6">Line 6</code> defines the <code>updateAnimation</code> function that receives a <code>step</code> value.</p>

                    <p><code class="desc desc-code5" data-line="7">Line 7</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code5" data-line="9">Line 9</code> clears the previously drawn rectangle by calling the <code>clearRect</code> method of <code>cx</code> with the previous rectangle values.</p>

                    <p><code class="desc desc-code5" data-line="10">Line 10</code> sets <code>strokeStyle</code> of <code>cx</code> to <code>"purple"</code> and <code>lineWidth</code> of <code>cx</code> to a string literal containing the current <code>lineWidth</code> value in pixels.</p>

                    <p><code class="desc desc-code5" data-line="11">Line 11</code> draws a new rectangle by calling the <code>strokeRect</code> method of <code>cx</code> with the upper-left corner denoted by the <code>rectLeftX</code> and <code>rectLeftY</code> values and the width and height both being the <code>rectLength</code> value.</p>

                    <p><code class="desc desc-code5" data-line="13">Line 13</code> increments <code>circleX</code> and <code>circleY</code> by the multiplication of <code>step</code> and <code>speedX</code> and <code>speedY</code> respectively.</p>

                    <p><code class="desc desc-code5" data-line="15">Line 15</code> sets the <code>strokeStyle</code> and <code>fillStyle</code> values of <code>cx</code> to <code>"red"</code>.</p>

                    <p><code class="desc desc-code5" data-line="16">Line 16</code> calls the <code>arc</code> method of <code>cx</code> create an circle with the center located at the <code>centerX</code> and <code>centerY</code> values, the radius being <code>circleRadius</code>, the start angle at 0, and the end angle at <code>Math.PI</code> multiplied by 2.</p>

                    <p><code class="desc desc-code5" data-line="17">Line 17</code> calls the <code>fill</code> method of <code>cx</code> to draw the circle.</p>

                    <p><code class="desc desc-code5" data-line="19">Line 19</code> checks whether <code>circleX</code>, <code>circleRadius</code>, and <code>lineWidth</code> added together is greater than or equal to <code>rectLeftX</code> and <code>rectLength</code> added together.</p>

                    <p>Or, <code class="desc desc-code5" data-line="20">Line 20</code> checks whether <code>circleRadius</code> and <code>lineWidth</code> subtracted from <code>circleX</code> is less than or equal to <code>rectLeftX</code>.</p>

                    <p>If true, <code class="desc desc-code5" data-line="21">Line 21</code> reverses <code>speedX</code> since the circle is hitting the side walls.</p>

                    <p><code class="desc desc-code5" data-line="24">Line 24</code> checks whether <code>circleY</code>, <code>circleRadius</code>, and <code>lineWidth</code> added together is greater than or equal to <code>rectLeftY</code> and <code>rectLength</code> added together.</p>

                    <p>Or, <code class="desc desc-code5" data-line="25">Line 25</code> checks whether <code>circleRadius</code> and <code>lineWidth</code> subtracted from <code>circleY</code> is less than or equal to <code>rectLeftX</code>.</p>

                    <p>If true, <code class="desc desc-code5" data-line="26">Line 26</code> reverses <code>speedY</code> since the circle is hitting the upper or lower walls.</p>
                </div>

                <div class="exercise-body">
                    <h3>Author's Answer</h3>

                    <pre id="code6" class="line-numbers linkable-line-numbers language-javascript" tabindex="0" data-line="0"><code class="language-javascript">let x = 100, y = 300;
let radius = 10;
let speedX = 100, speedY = 60;

function updateAnimation(step) {
    cx.clearRect(0, 0, 400, 400);
    cx.strokeStyle = "blue";
    cx.lineWidth = 4;
    cx.strokeRect(25, 25, 350, 350);

    x += step * speedX;
    y += step * speedY;
    if (x < 25 + radius || x > 375 - radius) speedX = -speedX;
    if (y < 25 + radius || y > 375 - radius) speedY = -speedY;
    cx.fillStyle = "red";
    cx.beginPath();
    cx.arc(x, y, radius, 0, 7);
    cx.fill();
}                   </code></pre>
                </div>

                <div class="exercise-body exercise-desc">
                    <p><code class="desc desc-code6" data-line="1">Line 1</code> initializes <code>x</code> to 100 and <code>y</code> to 300.</p>

                    <p><code class="desc desc-code6" data-line="2">Line 2</code> initializes <code>radius</code> to 100.</p>

                    <p><code class="desc desc-code6" data-line="3">Line 3</code> initializes <code>speedX</code> to 100 and <code>speedY</code> to 60.</p>

                    <p><code class="desc desc-code6" data-line="5">Line 5</code> defines the <code>updateAnimation</code> function that receives a <code>step</code> value.</p>

                    <p><code class="desc desc-code6" data-line="6">Line 6</code> clears the previously drawn rectangle by calling the <code>clearRect</code> method of <code>cx</code> with the x and y coordinates at 0 and the size set at 400 pixels.</p>

                    <p><code class="desc desc-code6" data-line="7">Line 7</code> sets <code>strokeStyle</code> of <code>cx</code> to <code>"blue"</code>.</p>

                    <p><code class="desc desc-code6" data-line="8">Line 8</code> sets <code>lineWidth</code> of <code>cx</code> to 4.</p>

                    <p><code class="desc desc-code6" data-line="9">Line 9</code> draws a rectangle by calling the <code>strokeRect</code> method of <code>cx</code> with the upper-left corner x and y coordinates at 25 pixels and the width and height both being 350.</p>

                    <p><code class="desc desc-code6" data-line="11">Line 11</code> increments <code>x</code> by <code>speedX</code> multiplied by <code>step</code>.</p>

                    <p><code class="desc desc-code6" data-line="12">Line 12</code> increments <code>y</code> by <code>speedY</code> multiplied by <code>step</code>.</p>

                    <p><code class="desc desc-code6" data-line="13">Line 13</code> checks whether <code>x</code> is less than <code>radius</code> increased by 25 or <code>x</code> is greater than <code>radius</code> subtracted from 375, reversing <code>speedX</code> if true.</p>

                    <p><code class="desc desc-code6" data-line="14">Line 14</code> checks whether <code>y</code> is less than <code>radius</code> increased by 25 or <code>y</code> is greater than <code>radius</code> subtracted from 375, reversing <code>speedY</code> if true.</p>

                    <p><code class="desc desc-code6" data-line="15">Line 15</code> sets <code>fillStyle</code> of <code>cx</code> to <code>"red"</code>.</p>

                    <p><code class="desc desc-code6" data-line="16">Line 16</code> begins a new drawing path in the canvas by calling the <code>beginPath</code> method of <code>cx</code>.</p>

                    <p><code class="desc desc-code6" data-line="17">Line 17</code> calls the <code>arc</code> method of <code>cx</code> create an circle with the center located at the <code>x</code> and <code>x</code> values, the radius being <code>radius</code>, the start angle at 0, and the end angle at 7.</p>

                    <p><code class="desc desc-code6" data-line="18">Line 18</code> calls the <code>fill</code> method of <code>cx</code> to draw the circle.</p>
                </div>

                <button class="exercise-body exercise-close">⇮</button>
            </section>

            <section class="exercise-panel">
                <div class="exercise-header"><h2>Precomputed Mirroring</h2></div>

                <div class="exercise-body">
                    <h3>Question</h3>

                    <p>One unfortunate thing about transformations is that they slow down the drawing of bitmaps. The position and size of each pixel has to be transformed, and though it is possible that browsers will get cleverer about transformation in the future, they currently cause a measurable increase in the time it takes to draw a bitmap.</p>

                    <p>In a game like ours, where we are drawing only a single transformed sprite, this is a nonissue. But imagine that we need to draw hundreds of characters or thousands of rotating particles from an explosion.</p>

                    <p>Think of a way to allow us to draw an inverted character without loading additional image files and without having to make transformed <code>drawImage</code> calls every frame.</p> 
                </div>

                <div class="exercise-body">
                    <h3>Personal Answer</h3>

                    <p>One solution would be to create a version of the inverted character that allows the user to make copies of it whenever needed. This can be accomplished by creating a <code><code>&lt;canvas></code></code> DOM element, drawing the character using <code>drawImage</code>, transforming the character using <code>scale</code>, <code>rotate</code>, or <code>translate</code>, and converting the canvas to an image using the <code>toDataURL</code> method.</p>
                </div>

                <div class="exercise-body">
                    <h3>Author's Answer</h3>

                    <p>The key to the solution is the fact that we can use a canvas element as a source image when using <code>drawImage</code>. It is possible to create an extra <code>&lt;canvas></code> element, without adding it to the document, and draw our inverted sprites to it, once. When drawing an actual frame, we just copy the already inverted sprites to the main canvas.</p>

                    <p>Some care would be required because images do not load instantly. We do the inverted drawing only once, and if we do it before the image loads, it won’t draw anything. A <code>"load"</code> handler on the image can be used to draw the inverted images to the extra canvas. This canvas can be used as a drawing source immediately (it’ll simply be blank until we draw the character onto it).</p>
                </div>

                <button class="exercise-body exercise-close">⇮</button>
            </section>

        </article>

        <article class="container-navbar">

            <section>

                <h3>3rd Edition</h3>

                <nav>
                    <ul>
                        <li><a href="../index.html" alt="Intro Link" title="Intro">Intro</a></li>
                        <li><a href="../chap1/index.html" alt="Chapter 1 Link" title="Chapter 1">Chapter 1 (Part 1: Language)</a></li>
                        <li><a href="../chap2/index.html" alt="Chapter 2 Link" title="Chapter 2">Chapter 2</a></li>
                        <li><a href="../chap3/index.html" alt="Chapter 3 Link" title="Chapter 3">Chapter 3</a></li>
                        <li><a href="../chap4/index.html" alt="Chapter 4 Link" title="Chapter 4">Chapter 4</a></li>
                        <li><a href="../chap5/index.html" alt="Chapter 5 Link" title="Chapter 5">Chapter 5</a></li>
                        <li><a href="../chap6/index.html" alt="Chapter 6 Link" title="Chapter 6">Chapter 6</a></li>
                        <li><a href="../chap7/index.html" alt="Chapter 7 Link" title="Chapter 7">Chapter 7</a></li>
                        <li><a href="../chap8/index.html" alt="Chapter 8 Link" title="Chapter 8">Chapter 8</a></li>
                        <li><a href="../chap9/index.html" alt="Chapter 9 Link" title="Chapter 9">Chapter 9</a></li>
                        <li><a href="../chap10/index.html" alt="Chapter 10 Link" title="Chapter 10">Chapter 10</a></li>
                    </ul>
                    <ul>
                        <li><a href="../chap11/index.html" alt="Chapter 11 Link" title="Chapter 11">Chapter 11</a></li>
                        <li><a href="../chap12/index.html" alt="Chapter 12 Link" title="Chapter 12">Chapter 12</a></li>
                        <li><a href="../chap13/index.html" alt="Chapter 13 Link" title="Chapter 13">Chapter 13 (Part 2: Browser)</a></li>
                        <li><a href="../chap14/index.html" alt="Chapter 14 Link" title="Chapter 14">Chapter 14</a></li>
                        <li><a href="../chap15/index.html" alt="Chapter 15 Link" title="Chapter 15">Chapter 15</a></li>
                        <li><a href="../chap16/index.html" alt="Chapter 16 Link" title="Chapter 16">Chapter 16</a></li>
                        <li><a href="../chap17/index.html" alt="Chapter 17 Link" title="Chapter 17">Chapter 17</a></li>
                        <li><a href="../chap18/index.html" alt="Chapter 18 Link" title="Chapter 18">Chapter 18</a></li>
                        <li><a href="../chap19/index.html" alt="Chapter 19 Link" title="Chapter 19">Chapter 19</a></li>
                        <li><a href="../chap20/index.html" alt="Chapter 20 Link" title="Chapter 20">Chapter 20 (Part 3: Node)</a></li>
                        <li><a href="../chap21/index.html" alt="Chapter 21 Link" title="Chapter 21">Chapter 21</a></li>
                    </ul>
                </nav>

            </section>

        </article>

    </main>

    <script src="../script.js"></script>
    <script src="../assets/js/prism.js"></script>

</body>

</html>