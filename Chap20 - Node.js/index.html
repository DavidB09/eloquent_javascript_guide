<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Eloquent JavaScript practice guide for chapter exercises and examples">
    <link rel="stylesheet" href="style.css">
    <link href="../Assets/CSS/prism.css" rel="stylesheet">
    <title>Eloquent JavaScript - Chapter 20</title>
    <meta name="author" content="David Brunner">
    <meta name="keywords" content="JavaScript, Eloquent JavaScript, Chapter 20, Exercises">
    <meta name="description" content="Solutions and explanations for exercises in Chapter 20 of Eloquent JavaScript.">
</head>

<body>

    <script src="../Assets/JavaScript/prism.js"></script>

    <header>
        <h1 id="chapter20-main-header">Chapter 20, "Node.js"</h1>
        
        <div id="navigation-links">
            <a href="../Chap19 - A Pixel Art Editor/Eloquent_JavaScript_HTML_Chap19.html" alt="Chapter 19 Link" title="Chapter 19">Previous</a>
            <a href="../Chap21 - Skill-Sharing Website/index.html" alt="Chapter 21 Link" title="Chapter 21">Next</a>
        </div>
    </header>

    <main>

        <article id="exercise-problems">

            <section id="exercise1" class="panel">
                <div id="exercise-header1" class="header"><h2>Search Tool</h2></div>

                <div id="exercise-question1" class="body">
                    <h3>Question</h3>

                    <p>On Unix systems, there is a command line tool called <code>grep</code> that can be used to quickly search files for a regular expression.</p>

                    <p>Write a Node script that can be run from the command line and acts somewhat like <code>grep</code>. It treats its first command line argument as a regular expression and treats any further arguments as files to search. It should output the names of any file whose content matches the regular expression.</p>

                    <p>When that works, extend it so that when one of the arguments is a directory, it searches through all files in that directory and its subdirectories.</p>

                    <p>Use asynchronous or synchronous file system functions as you see fit. Setting things up so that multiple asynchronous actions are requested at the same time might speed things up a little, but not a huge amount, since most file systems can read only one thing at a time.</p>
                </div>

                <div id="personal-answer1" class="body">
                    <h3>Personal Answer</h3>

                    <pre class="language-javascript line-numbers"><code class="language-javascript">const {stat, readdir, readFile} = require('fs').promises; 

async function handleInput() {
    if (process.argv.length < 4) return 'Wrong Usage: node jsfile.js regex sourcefile';

    let fileNames = []; 
    try {
        for (let i = 3; i < process.argv.length; i++) {
            fileNames.push(...await handleFile(process.argv[i], process.argv[2], [])); 
        }
        return fileNames; 
    } catch (error) {
        throw error
    }
}

handleInput()
    .then(files => console.log(`Files: ${files.length > 0 ? files.join(', ') : 'None'}`))
    .catch(error => console.log(error)); 

async function handleFile(resource, test, currNames) {    
    try {
        let stats = await stat(resource); 

        if (stats.isDirectory()) {
            let dirFiles = await readdir(resource); 
            for (let i = 0; i < dirFiles.length; i++) {
                currNames.push(...await handleFile(`${resource}/${dirFiles[i]}`, test, [])); 
            }
            return currNames; 
        }

        if (stats.isFile()) {
            let text = await readFile(resource, "utf8"); 
            let regex = new RegExp(test, 'g'); 

            if (regex.test(text)) return [...currNames, resource]; 
            else return []; 
        }

    } catch (error) {
        throw 'File not found'; 
    }
}                   </code></pre>
                </div>

                <div id="personal-answer-explanation1" class="body">
                    <p><code>Line 1</code> defines the <code>array</code> method within the <code>topScope</code> object that destructures the values provided by its parameter.</p>

                </div>

                <div id="official-answer1" class="body">
                    <h3>Author's Answer</h3>

                    <pre class="language-javascript line-numbers"><code class="language-javascript">const {statSync, readdirSync, readFileSync} = require("fs");

let searchTerm = new RegExp(process.argv[2]);

for (let arg of process.argv.slice(3)) {
    search(arg);
}

function search(file) {
    let stats = statSync(file);
    if (stats.isDirectory()) {
        for (let f of readdirSync(file)) {
            search(file + "/" + f);
        }
    } else if (searchTerm.test(readFileSync(file, "utf8"))) {
        console.log(file);
    }
}                   </code></pre>
                </div>

                <div id="official-answer-explanation1" class="body">
                    <p>The author used the same logic just expressed in more concise code.</p>
                </div>

                <div id="exercise-close1" class="body close"><p>⇮</p></div>
            </section>

            <section id="exercise2" class="panel">
                <div id="exercise-header2" class="header"><h2>Directory Creation</h2></div>

                <div id="exercise-question2" class="body">
                    <h3>Question</h3>

                    <p>Though the <code>DELETE</code> method in our file server is able to delete directories (using <code>rmdir</code>), the server currently does not provide any way to create a directory.</p>

                    <p>Add support for the <code>MKCOL</code> method (“make collection”), which should create a directory by calling <code>mkdir</code> from the <code>fs</code> module. <code>MKCOL</code> is not a widely used HTTP method, but it does exist for this same purpose in the WebDAV standard, which specifies a set of conventions on top of HTTP that make it suitable for creating documents.</p> 
                </div>

                <div id="personal-answer2" class="body">
                    <h3>Personal Answer</h3>

                <pre class="language-javascript line-numbers"><code class="language-javascript">const {mkdir} = require("fs").promises; 

methods.MKCOL = async function(request) {
    let path = urlPath(request.url); 
    try {
        let stats = await stat(path); 
        if (stats.isDirectory()) return {status: 204}; 
        else return {status: 400, body: "Name already exists as a file"}; 
    } catch (error) {
        if (error.code != "ENOENT") throw error; 
        await mkdir(path); 
        return {status: 204}; 
    }
};                  </code></pre>
                </div>

                <div id="personal-answer-explanation2" class="body">

                </div>

                <div id="official-answer2" class="body">
                    <h3>Author's Answer</h3>

                    <pre class="language-javascript line-numbers"><code class="language-javascript">const {mkdir} = require("fs").promises;

methods.MKCOL = async function(request) {
    let path = urlPath(request.url);
    let stats;
    try {
        stats = await stat(path);
    } catch (error) {
        if (error.code != "ENOENT") throw error;
        await mkdir(path);
        return {status: 204};
    }
    if (stats.isDirectory()) return {status: 204};
    else return {status: 400, body: "Not a directory"};
};                  </code></pre>
                </div>

                <div id="official-answer-explanation2" class="body">
                    
                </div>

                <div id="exercise-close2" class="body close"><p>⇮</p></div>
            </section>

            <section id="exercise3" class="panel">
                <div id="exercise-header3" class="header"><h2>A Monster</h2></div>

                <div id="exercise-question3" class="body">
                    <h3>Question</h3>

                    <p>It is traditional for platform games to have enemies that you can jump on top of to defeat. This exercise asks you to add such an actor type to the game.</p>

                    <p>We’ll call it a monster. Monsters move only horizontally. You can make them move in the direction of the player, bounce back and forth like horizontal lava, or have any movement pattern you want. The class doesn’t have to handle falling, but it should make sure the monster doesn’t walk through walls.</p>

                    <p>When a monster touches the player, the effect depends on whether the player is jumping on top of them or not. You can approximate this by checking whether the player’s bottom is near the monster’s top. If this is the case, the monster disappears. If not, the game is lost.</p> 
                </div>

                <div id="personal-answer3" class="body">
                    <h3>Personal Answer</h3>

                    <pre class="language-javascript line-numbers"><code class="language-javascript"> </code></pre>
                </div>

                <div id="personal-answer-explanation3" class="body">
                    <p><code>Line 1</code> defines the <code>set</code> method found within the <code>specialForms</code> object with the <code>args</code> and <code>scope</code> parameters.</p>

                </div>

                <div id="official-answer3" class="body">
                    <h3>Author's Answer</h3>

                    <pre class="language-javascript line-numbers"><code class="language-javascript"></code></pre>
                </div>

                <div id="official-answer-explanation3" class="body">
                    <p><code>Line 1</code> defines the <code>set</code> method found within the <code>specialForms</code> object with the <code>args</code> and <code>env</code> parameters.</p>

                </div>

                <div id="exercise-close3" class="body close"><p>⇮</p></div>
            </section>

        </article>

        <article id="navbar-article">

            <section id="navbar-section-3rd-Ed">
                
                <h3>3rd Edition</h3>

                <nav id="navbar-3rd-Ed">
                <ul>
                    <li><a href="../Intro/Eloquent_JavaScript_HTML_Intro.html" alt="Intro Link" title="Intro">Intro</a></li>
                    <li><a href="../Chap1 - Values, Types, and Operators/Eloquent_JavaScript_HTML_Chap1.html" alt="Chapter 1 Link" title="Chapter 1">Chapter 1 (Part 1: Language)</a></li>
                    <li><a href="../Chap2 - Program Structure/Eloquent_JavaScript_HTML_Chap2.html" alt="Chapter 2 Link" title="Chapter 2">Chapter 2</a></li>
                    <li><a href="../Chap3 - Functions/Eloquent_JavaScript_HTML_Chap3.html" alt="Chapter 3 Link" title="Chapter 3">Chapter 3</a></li>
                    <li><a href="../Chap4 - Data Structures/Eloquent_JavaScript_HTML_Chap4.html" alt="Chapter 4 Link" title="Chapter 4">Chapter 4</a></li>
                    <li><a href="../Chap5 - Higher-Order Functions/Eloquent_JavaScript_HTML_Chap5.html" alt="Chapter 5 Link" title="Chapter 5">Chapter 5</a></li>
                    <li><a href="../Chap6 - The Secret Life of Objects/Eloquent_JavaScript_HTML_Chap6.html" alt="Chapter 6 Link" title="Chapter 6">Chapter 6</a></li>
                    <li><a href="../Chap7 - A Robot Project/Eloquent_JavaScript_HTML_Chap7.html" alt="Chapter 7 Link" title="Chapter 7">Chapter 7</a></li>
                    <li><a href="../Chap8 - Bugs and Errors/Eloquent_JavaScript_HMTL_Chap8.html" alt="Chapter 8 Link" title="Chapter 8">Chapter 8</a></li>
                    <li><a href="../Chap9 - Regular Expressions/Eloquent_JavaScript_HTML_Chap9.html" alt="Chapter 9 Link" title="Chapter 9">Chapter 9</a></li>
                    <li><a href="../Chap10 - Modules/Eloquent_JavaScript_HTML_Chap10.html" alt="Chapter 10 Link" title="Chapter 10">Chapter 10</a></li>
                    <li><a href="../Chap11 - Asynchronous Programming/Eloquent_JavaScript_HTML_Chap11.html" alt="Chapter 11 Link" title="Chapter 11">Chapter 11</a></li>
                    <li><a href="../Chap12 - A Programming Language/Eloquent_JavaScript_HTML_Chap12.html" alt="Chapter 12 Link" title="Chapter 12">Chapter 12</a></li>
                    <li><a href="../Chap13 - Javascript and the Browser/Eloquent_Javascript_HTML_Chap13.html" alt="Chapter 13 Link" title="Chapter 13">Chapter 13 (Part 2: Browser)</a></li>
                    <li><a href="../Chap14 - The Document Object Model/Eloquent_JavaScript_HTML_Chap14.html" alt="Chapter 14 Link" title="Chapter 14">Chapter 14</a></li>
                    <li><a href="../Chap15 - Handling Events/Eloquent_JavaScript_HTML_Chap15.html" alt="Chapter 15 Link" title="Chapter 15">Chapter 15</a></li>
                    <li><a href="../Chap16 - A Platform Game/Eloquent_JavaScript_HTML_Chap16.html" alt="Chapter 16 Link" title="Chapter 16">Chapter 16</a></li>
                    <li><a href="../Chap17 - Drawing on Canvas/Eloquent_JavaScript_HTML_Chap17.html" alt="Chapter 17 Link" title="Chapter 17">Chapter 17</a></li>
                    <li><a href="../Chap18 - HTTP and Forms/Eloquent_JavaScript_HTML_Chap18.html" alt="Chapter 18 Link" title="Chapter 18">Chapter 18</a></li>
                    <li><a href="../Chap19 - A Pixel Art Editor/Eloquent_JavaScript_HTML_Chap19.html" alt="Chapter 19 Link" title="Chapter 19">Chapter 19</a></li>
                    <li><a href="../Chap20 - Node.js/index.html" alt="Chapter 20 Link" title="Chapter 20">Chapter 20 (Part 3: Node)</a></li>
                    <li><a href="../Chap21 - Skill-Sharing Website/index.html" alt="Chapter 21 Link" title="Chapter 21">Chapter 21</a></li>
                </ul>
                </nav>

            </section>

        </article>

    </main>

    <script type="text/javascript" src="script.js"></script>
    
</body>

</html>